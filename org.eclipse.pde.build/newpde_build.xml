<?xml version="1.0" encoding="UTF-8"?>
<project name="org.eclipse.pde.core" default="build.jars" basedir=".">

	<target name="initTemplate" unless="template">
		<initTemplate/>
	</target>

	<target name="init" depends="initTemplate, properties">
	</target>

	<target name="build.update.jar" depends="init">
		<property name="base" value="${basedir}/bin.zip.pdetemp"/>
		<delete dir="${base}"/>
		<mkdir dir="${base}"/>
		<antcall target="build.jars"/>
		<antcall target="gather.bin.parts">
			<param name="destination" value="${base}/"/>
		</antcall>
		<delete>
			<fileset dir="${base}" includes="**/*.bin.log"/>
		</delete>
		<zip zipfile="${basedir}/${plugin}_${version}.jar" basedir="${base}/plugins/${plugin}"/>
		<delete dir="${base}"/>
	</target>

	<target name="gather.bin.parts" depends="init" if="destination">
		<ant antfile="${template}" target="includesExcludesCopy">
			<property name="srcdir" value="${basedir}"/>
			<property name="dest" value="${destination}/plugins/${plugin}"/>
			<property name="excludes" value="${bin.excludes}"/>
			<property name="includes" value="${bin.includes}"/>
		</ant>
	</target>

	<target name="lib/pdecore-ant.jar" depends="init">
		<ant antfile="${template}" target="jar">
			<property name="dest" value="${basedir}/lib/pdecore-ant.jar"/>
			<property name="srcdir" value="${basedir}"/>
			<property name="includes" value="src_ant/"/>
			<property name="excludes" value=""/>
			<property name="mapping" value="src_ant/"/>
			<property name="compilePath" value="${location.org.eclipse.core.runtime}/bin;${location.org.eclipse.core.runtime}/runtime.jar;${location.org.eclipse.core.boot}/bin;${location.org.eclipse.core.boot}/boot.jar;${location.org.eclipse.pde.core}/bin;${location.org.eclipse.pde.core}/pdecore.jar;${location.org.apache.ant}/bin;${location.org.apache.ant}/ant.jar;${location.org.apache.ant}/jakarta-ant-1.4.1-optional.jar;${location.org.apache.xerces}/bin;${location.org.apache.xerces}/xerces.jar;${location.org.eclipse.ant.core}/bin;${location.org.eclipse.ant.core}/antsupport.jar;${location.org.eclipse.jdt.core}/bin;${location.org.eclipse.jdt.core}/jdtcore.jar;${location.org.eclipse.core.resources}/bin;${location.org.eclipse.core.resources}/resources.jar;${location.org.eclipse.update.core}/bin;${location.org.eclipse.update.core}/updatecore.jar;${location.org.eclipse.help}/bin;${location.org.eclipse.help}/help.jar;${location.org.apache.lucene}/bin;${location.org.apache.lucene}/lucene-1.2-rc2.jar;${location.org.apache.lucene}/lucenedemo.zip;${location.org.eclipse.pde.core}/bin"/>
		</ant>
	</target>

	<target name="pdecore.jar" depends="init">
		<ant antfile="${template}" target="jar">
			<property name="dest" value="${basedir}/pdecore.jar"/>
			<property name="srcdir" value="${basedir}"/>
			<property name="includes" value="src/"/>
			<property name="excludes" value=""/>
			<property name="mapping" value="src/"/>
			<property name="compilePath" value="${location.org.eclipse.core.runtime}/bin;${location.org.eclipse.core.runtime}/runtime.jar;${location.org.eclipse.core.boot}/bin;${location.org.eclipse.core.boot}/boot.jar;${location.org.eclipse.pde.core}/bin;${location.org.eclipse.pde.core}/pdecore.jar;${location.org.apache.ant}/bin;${location.org.apache.ant}/ant.jar;${location.org.apache.ant}/jakarta-ant-1.4.1-optional.jar;${location.org.apache.xerces}/bin;${location.org.apache.xerces}/xerces.jar;${location.org.eclipse.ant.core}/bin;${location.org.eclipse.ant.core}/antsupport.jar;${location.org.eclipse.jdt.core}/bin;${location.org.eclipse.jdt.core}/jdtcore.jar;${location.org.eclipse.core.resources}/bin;${location.org.eclipse.core.resources}/resources.jar;${location.org.eclipse.update.core}/bin;${location.org.eclipse.update.core}/updatecore.jar;${location.org.eclipse.help}/bin;${location.org.eclipse.help}/help.jar;${location.org.apache.lucene}/bin;${location.org.apache.lucene}/lucene-1.2-rc2.jar;${location.org.apache.lucene}/lucenedemo.zip"/>
		</ant>
	</target>

	<target name="build.jars" depends="init,pdecore.jar,lib/pdecore-ant.jar">
	</target>

	<target name="build.zips" depends="init">
	</target>

	<target name="gather.sources" depends="init" if="destination">
		<mkdir dir="${destination}/plugins/${plugin}/lib"/>
		<copy file="${basedir}/lib/pdecore-antsrc.zip" todir="${destination}/plugins/${plugin}/lib"/>
		<mkdir dir="${destination}/plugins/${plugin}"/>
		<copy file="${basedir}/pdecoresrc.zip" todir="${destination}/plugins/${plugin}"/>
	</target>

	<target name="lib/pdecore-antsrc.zip" depends="init">
		<ant antfile="${template}" target="src">
			<property name="srcdir" value="${basedir}"/>
			<property name="mapping" value="src_ant/"/>
			<property name="dest" value="${basedir}/lib/pdecore-antsrc.zip"/>
			<property name="excludes" value=""/>
			<property name="includes" value="src_ant/**/*.java"/>
		</ant>
	</target>

	<target name="pdecoresrc.zip" depends="init">
		<ant antfile="${template}" target="src">
			<property name="srcdir" value="${basedir}"/>
			<property name="mapping" value="src/"/>
			<property name="dest" value="${basedir}/pdecoresrc.zip"/>
			<property name="excludes" value=""/>
			<property name="includes" value="src/**/*.java"/>
		</ant>
	</target>

	<target name="build.sources" depends="init,lib/pdecore-antsrc.zip,pdecoresrc.zip">
	</target>

	<target name="gather.logs" depends="init">
		<mkdir dir="${destination}/plugins/${plugin}/lib"/>
		<copy file="${basedir}/lib/pdecore-ant.jar.bin.log" todir="${destination}/plugins/${plugin}/lib"/>
		<mkdir dir="${destination}/plugins/${plugin}"/>
		<copy file="${basedir}/pdecore.jar.bin.log" todir="${destination}/plugins/${plugin}"/>
	</target>

	<target name="clean" depends="init">
		<delete>
			<fileset dir="${basedir}" includes="*.bin"/>
			<fileset dir="${basedir}" includes="**/*.log"/>
			<fileset dir="${basedir}" includes="lib/pdecore-ant.jar,pdecore.jar"/>
			<fileset dir="${basedir}" includes="lib/pdecore-antsrc.zip,pdecoresrc.zip"/>
			<fileset dir="${basedir}" includes="**/*.pdetemp"/>
		</delete>
		<delete file="${plugin}_${version}.jar"/>
		<delete file="${plugin}_${version}.src.zip"/>
		<delete file="${plugin}_${version}.log.zip"/>
	</target>

	<target name="properties">
		<property name="plugin" value="org.eclipse.pde.core"/>
		<property name="version" value="2.1.2"/>
		<pluginLocation plugin="org.eclipse.update.core" property="location.org.eclipse.update.core"/>
		<pluginLocation plugin="org.apache.ant" property="location.org.apache.ant"/>
		<pluginLocation plugin="org.eclipse.jdt.core" property="location.org.eclipse.jdt.core"/>
		<pluginLocation plugin="org.eclipse.ant.core" property="location.org.eclipse.ant.core"/>
		<pluginLocation plugin="org.eclipse.pde.core" property="location.org.eclipse.pde.core"/>
		<pluginLocation plugin="org.eclipse.help" property="location.org.eclipse.help"/>
		<pluginLocation plugin="org.eclipse.core.boot" property="location.org.eclipse.core.boot"/>
		<pluginLocation plugin="org.apache.lucene" property="location.org.apache.lucene"/>
		<pluginLocation plugin="org.eclipse.core.runtime" property="location.org.eclipse.core.runtime"/>
		<pluginLocation plugin="org.apache.xerces" property="location.org.apache.xerces"/>
		<pluginLocation plugin="org.eclipse.core.resources" property="location.org.eclipse.core.resources"/>
		<property name="bin.includes" value="plugin.xml,*.jar,plugin.properties,template.xml,about.html,lib/"/>
		<property name="bin.excludes" value="src/,src_ant/"/>
	</target>

</project>
