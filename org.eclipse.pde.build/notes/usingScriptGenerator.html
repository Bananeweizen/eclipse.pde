<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (WinNT; I) [Netscape]">
   <title>Using PDE Core to build Plug-ins, Fragments and Features</title>
</head>
<body>

<h2>
What is PDE Core?</h2>
&nbsp;&nbsp;&nbsp; PDE Core is a plug-in that helps users building their
own plug-ins. The term building here is related to deployment and not development.
Basically, PDE Core takes an Eclipse Plug-in Project, its plugin.xml and
build.properties files and generate a build.xml script to be run by Ant.
Building plug-ins, fragments or features consists of the 3 stages: fetch,
generate scripts and build that are described bellow.
<p><b>Fetch</b>
<br>&nbsp;&nbsp;&nbsp; Consists of taking the interesting elements from
a repository to the build machine. These elements can be plug-ins, fragments
or features. A file called directory.txt is responsible for identifying
where, how and which plug-ins should go to the build machine. Ths file
is basically a Java properties file where the entries have the following
format: <i>element@element_id=tag,:connection_type:user@host:repository</i>
<br>Examples:
<ul>
<li>
plugin@org.eclipse.pde=v20011211, :pserver:anonymous@dev.eclipse.org:/home/eclipse,</li>

<li>
feature@org.eclipse.jdt=v20011120, :pserver:anonymous@dev.eclipse.org:/home/eclipse,</li>
</ul>
The current implementation of fetch only works against CVS repositories
and there are no plans for supporting different kinds. Skiping or substituting
this step should not be hard for users of other VCM systems or other kind
of storage.
<p><b>Generate Scripts</b>
<br>&nbsp;&nbsp;&nbsp; Once the plug-ins, fragments and features are in
place, we need to generate the build.xml scripts. These Ant scripts drive
the build process. In order to generate them, PDE Core takes as input the
plugin.xml, fragment.xml, feature.xml and build.properties files. The complete
description of the first 3 files are elsewhere. Here we will only fully
describe the build.properties file and relevant parts of the others.
<p><b>Build</b>
<br>&nbsp;&nbsp;&nbsp; This step is basically executed by Ant, although
we do need Eclipse defined tasks and types. One important thing here is
to know exactly what targets to call in order to get the desired result.
<br>&nbsp;
<h2>
How do I use PDE Core?</h2>
<b>Fetch</b>
<br>&nbsp;&nbsp;&nbsp; PDE Core provides the <tt>org.eclipse.pde.core.fetch</tt>
application...
<br>&nbsp;&nbsp;&nbsp; ...
<br>&nbsp;&nbsp;&nbsp; explain the ant task as well
<br>&nbsp;&nbsp;&nbsp; ...
<p><b>Generate Scripts</b>
<br>&nbsp;&nbsp;&nbsp; In order to generate build.xml scripts for some
element, it is necessary to use the <tt>org.eclipse.pde.core.script</tt>
application extension point provided by PDE Core. The arguments for this
application are:
<ul>
<li>
<tt>-?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
prints usage</tt></li>

<li>
<tt>-nochildren&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; feature's children
should not have scripts generated</tt></li>

<li>
<tt>-dev &lt;args>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -</tt></li>

<li>
<tt>-elements &lt;arg>&nbsp;&nbsp; comma-separated list of elements</tt></li>

<li>
<tt>-install &lt;arg>&nbsp;&nbsp;&nbsp; -</tt></li>

<li>
<tt>-plugins&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -</tt></li>

<li>
<tt>-stamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-</tt></li>

<li>
<tt>-os&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-</tt></li>

<li>
<tt>-ws&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-</tt></li>

<li>
<tt>-nl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-</tt></li>
</ul>

<p><br>Examples:
<p><tt>(1) java -cp startup.jar org.eclipse.core.launcher.Main</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -application org.eclipse.pde.core.script</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -elements plugin@org.eclipse.core.resources</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -install c:\mybuild\</tt>
<p><tt>(2) java -cp startup.jar org.eclipse.core.launcher.Main</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -application org.eclipse.pde.core.script</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -elements plugin@org.eclipse.core.resources,fragment@my.fragment</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -install c:\mybuild\</tt>
<p><tt>(3) java -cp startup.jar org.eclipse.core.launcher.Main</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -application org.eclipse.pde.core.script</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -elements feature@org.eclipse.platform.feature
-nochildren</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -install c:\mybuild\</tt>
<p>&nbsp;&nbsp;&nbsp; ...
<br>&nbsp;&nbsp;&nbsp; [explain the ant task as well]
<br>&nbsp;&nbsp;&nbsp; ...
<br>&nbsp;
<p><b>build.properties</b>
<br>&nbsp;&nbsp;&nbsp; This file is used to specialize the way the build.xml
script is generated. The possible entries are described bellow:
<p><b><tt>custom = yes</tt></b>
<br>&nbsp;&nbsp;&nbsp; Tells the script generator that no script is necessary
for the current element. It is usually used when a custom build.xml script
is provided. The build.xml script has to be in the root of the element.
<p>bin.includes =
<p>bin.excludes =
<br>&nbsp;
<p><b><tt>build variables</tt></b>
<br>&nbsp;&nbsp;&nbsp; There are currenttly 4 build variables: os, ws,
nl and arch. The <tt>build.properties</tt> file or a custom <tt>build.xml</tt>
script can make use of them in order to create platform specific builds.
<br>&nbsp;&nbsp;&nbsp; They can be referenced inside the script as normal
Ant properties, whose values are retrived by ${variable_name}.
<br>&nbsp;&nbsp;&nbsp; In the <tt>build.properties</tt> file, they can
be used as follows:
<p><tt>&nbsp; ${os/linux}.bin.includes = src/linux</tt>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Indicates that the folder
src/linux should be include to the bin target if os=linux .
<p><tt>&nbsp; ${os/linux,ws/motif}.bin.includes = src/linux</tt>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Indicates that the folder
src/linux should be include to the bin target if os=linux and ws=motif
.
<p><tt>&nbsp; ${os/*,ws/motif}.bin.includes = src/motif</tt>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Indicates that the folder
src/motif should be include to the bin target if ws=motif on any os .
<br>&nbsp;
<p><b>Build</b>
<p>Targets:
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<p><b><font color="#FF0000">To be implemented:</font></b>
<ul>
<li>
Improve error handling, messages and exceptions. It is very weak currently.</li>

<li>
Remove the 101 ways of doing the same thing. We should stay with the least
that works.</li>

<li>
Write comments.</li>

<li>
custom build.xml for features</li>
</ul>

<br>&nbsp;
<h1>
Features:</h1>
To be written...
<h1>
Plug-ins:</h1>

<h3>
How do I build a plug-in using PDE Core?</h3>
Actually, PDE Core does not build plug-ins. It only generates Ant scripts
that will do the job.
<p>One way to generate a build.xml script for a plug-in is through the
command line. EXPLAIN WHAT IS THE CORRECT SETUP
<pre>java -cp startup.jar org.eclipse.core.launcher.Main -dev bin -application org.eclipse.pde.core.plugin -plugin org.eclipse.core.resources
java -cp startup.jar org.eclipse.core.launcher.Main -dev bin -application org.eclipse.ant.core.antRunner -file plugins\org.eclipse.core.resources\plugin.xml</pre>
Another way is calling an Ant task provided by PDE Core:
<pre>To be written...
&lt;buildscript elements="org.eclipse.pde.core.plugin"/></pre>

<h1>
Fragments:</h1>
To be written...
<h1>
General information:</h1>

<h3>
How can a plug-in provide its own build.xml and not rely on PDE Core?</h3>
The plug-in only needs to provide 2 files: <b>build.xml</b> and <b>build.properties</b>.
<ul>
<li>
<b>build.xml</b> is the Ant script responsible for building the current
plug-in</li>

<li>
<b>build.properties</b> should contain the entry <b>custom=true</b> to
indicate that PDE Core should not generate scripts for this plug-in</li>
</ul>

<h3>
How to provide platform dependent variables on the build.properties file?</h3>
It is only necessary to append <b>${variables here}.</b> as a prefix of
the property. The available variables are <b>os</b>, <b>ws</b>, <b>nl</b>
and <b>arch</b>. They can also be used together. The examples bellow illustrate
it better:
<ul>
<li>
<b>${os/linux,ws/motif}.bin.includes=src/linux</b> indicates that the folder
<b>src/linux</b>
should be include to the bin target if os=linux and ws=motif</li>

<li>
<b>${os/*,ws/motif}.bin.includes=src/linux</b> indicates that the folder
<b>src/linux</b>
should be include to the bin target if ws=motif on any os.</li>
</ul>

<h3>
&lt;...more to come...></h3>
&nbsp;
<p>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h2>
Definitions:</h2>
build machine&nbsp;&nbsp;&nbsp; = the machine where the build process is
being executed
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h1>
<font color="#FF0000">Old text being rewritten:</font></h1>

<pre>
The command-line switches for these generators are:

PluginBuildScriptGenerator
-install directoryName: specifies the root directory of the target eclipse platform
-plugins pluginPath: optional, specifies base directory for plug-ins
-plugin pluginId: specifies the id of a plug-in to generate; any number of these may be specified
-dev classPathEntries: optional, sets the additional development model class path entries

FragmentBuildScriptGenerator
-install directoryName: specifies the root directory of the target eclipse platform
-plugins fragmentPath: optional, specifies base directory for fragments
-fragment fragmentId: specifies the id of a fragment to generate; any number of these may be specified
-dev classPathEntries: optional, sets the additional development model class path entries

ComponentBuildScriptGenerator
-install directoryName: specifies the root directory of the target eclipse platform
-nochildren: optional, specifies that script generation for contained plug-ins and fragments should not be invoked
-component: the id of the component to generate

ConfigurationBuildScriptGenerator
-install directoryName: specifies the root directory of the target eclipse platform
-nochildren: optional, specifies that script generation for contained components should not be invoked
-configuration: the id of the configuration to generate


Build Specifications for Plug-ins and Fragments

The build mechanism is driven by a build specification. The specification for an individual plug-in,
fragment, component or configuration is found in a build.properties file in the corresponding element.
This file describes where to find the source code for the element.&nbsp; Other entries describe which files
should be included/excluded in/from various forms of distribution (e.g., binary, source, doc).

Specifying Source for Plug-ins and Fragments

Plug-ins requiring compilation must define a build.properties file in order to specify the location of
their source.&nbsp; This file is a simple properties file.&nbsp; The properties must be of form
source.<jarName>=<source directories>, where source directories can be a comma-separated list if needed.
For example:

source.resources.jar=src

Substitutable Values

Plugins and Fragments

There are currently six points where text can be specified by a plug-in or fragment for inclusion
in its generated build.xml file.&nbsp; These points are:

bin.includes
bin.excludes
javadoc.packages
javadoc.excludedpackages
src.includes
src.excludes

The values defined in these points are expressed as Ant "patterns".&nbsp; Typically this amounts to a
comma-separated list of strings to match.&nbsp; Standard formats give the expected results
(e.g., *.jar indicates all jar files in the top level directory, etc).&nbsp; There are a few
hints/shortcuts.&nbsp; The patterns are not deep by default.&nbsp; If you want to describe all Java files for
example, you should use the patter "**/*.java". "**" matches any number of directory levels.
Similarly, to describe whole subtrees, use "foo/".

Default values for these points are always automatically generated with identifiers of form
auto.<lastPortionOfPointId>.&nbsp; This is done to allow your override to extend these default
values if desired.&nbsp; To set override values, a plug-in defines additional name/value properties
in the previously-mentioned build.properties file.&nbsp; Some examples:

bin.includes=plugin.xml,*.jar
javadoc.packages=${auto.packages},org.eclipse.core.target.*
src.excludes=${auto.excludes},*Hack.java

Components and Configurations

There are currently two points where text can be specified by a component or configuration
for inclusion in its generated build.xml file.&nbsp; These points are:

bin.includes
bin.excludes

Default values for these points are always automatically generated with identifiers of form
auto.<lastPortionOfPointId>.&nbsp; This is done to allow your override to extend these default values if desired.

</pre>

</body>
</html>
