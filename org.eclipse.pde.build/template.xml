<?xml version="1.0" encoding="UTF-8"?>

<project name="build template" default="dist">
  <target name="init">
    <property name="build.compiler" value="org.eclipse.pde.internal.core.JDTCompilerAdapter"/>
  </target>
  <commapatternset id="pattern.id" includes="${includes}" excludes="${excludes}"/>
  <commapatternset id="copy.id" includes="${includes}" excludes="**/*.java"/>
  <commapatternset id="includes.id" includes="${includes}"/>
  <commapatternset id="excludes.id" excludes="${excludes}"/>
  <fileset id="file.id" dir=".">
    <patternset refid="pattern.id"/>
  </fileset>  
  <path id="path.id">
    <fileset refid="file.id"/>
  </path>
  <stripMapper id="stripMapper.id" from="${mapping}"/>
  
  <target name="jar" depends="init">
    <property name="out" value="${dest}.bin"/>
    <delete dir="${out}"/>
    <mkdir dir="${out}"/>
    <javac srcdir="${basedir}" destdir="${out}" verbose="yes" failonerror="no">
      <patternset refid="pattern.id"/>
      <classpath path="${compilePath}"/>
    </javac>
    <copy todir="${out}">
      <fileset dir=".">
         <patternset refid="copy.id"/>
      </fileset>
      <mapper refid="stripMapper.id"/>
    </copy>
    <jar jarfile="${dest}" basedir="${out}"/>
    <copy file="${out}.log" todir="${basedir}"/>
    <copy file="${dest}" todir="${basedir}"/>
    <delete dir="${out}"/>
  </target>

  <target name="javadoc" depends="init">
    <javadoc 
      sourcepath="${sourcepath}"
      destdir="${out}"
      packagenames="${packages}"
      classpath="${compilePath}" 
      excludepackagenames="${excludedpackages}">
    </javadoc>
  </target>

  <target name="bin" depends="init">
    <mkdir dir="${dest}"/>
    <copy todir="${dest}">
      <fileset refid="file.id"/>
    </copy>
  </target>

  <target name="src" depends="init">
    <delete dir="${dest}.pdetemp" />
    <mkdir dir="${dest}.pdetemp" />
    <copy todir="${dest}.pdetemp">
      <fileset refid="file.id"/>
      <mapper refid="stripMapper.id"/>
    </copy>
    <delete file="${dest}"/>
    <zip zipfile="${dest}" basedir="${dest}.pdetemp"/>
    <delete dir="${dest}.pdetemp"/>
  </target>

  <target name="log" depends="init">
    <delete dir="${dest}"/>
    <mkdir dir="${dest}"/>
    <copy todir="${dest}">
      <fileset dir="." includes="*.log"/>
      <mapper type="glob" from="*.bin.log" to="*.log"/>
    </copy>
  </target>

  <target name="doc-copy" depends="init" if="doc-exists">
    <copy todir="${dest}/doc">
      <fileset dir="doc" includes="*"/>
    </copy>
  </target>

  <target name="doc" depends="init">
    <delete dir="${dest}/${plugin}/doc" />
    <mkdir dir="${dest}/${plugin}/doc" />
    <available property="doc-exists" file="doc"/>
    <antcall target="doc-copy"/>
    <copy todir="${dest}/doc/javadoc">
      <fileset dir="javadoc"/>
    </copy>
  </target>

  <target name="clean" depends="init">
    <delete>
      <fileset dir="." includes="*.bin" />
      <fileset dir="." includes="*.log" />
      <fileset dir="." includes="${jar}" />
      <fileset dir="." includes="${srczips}" />
    </delete>
    <delete dir="javadoc"/>
  </target>
</project>

